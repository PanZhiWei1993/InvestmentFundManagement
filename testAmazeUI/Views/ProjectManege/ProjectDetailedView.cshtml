
@{
    ViewBag.Title = "ProjectDetailedView";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@using testAmazeUI.Models.resultModel;
@{
    var ProjcetInfo = ViewBag.ProjcetInfo == null ? new ReProjectInfo() : ViewBag.ProjcetInfo;

    var ProjectDocmentList = ViewBag.ProjectDocmentList;
    //var ProjectFlieList = ViewBag.ProjectFlieList;
    var ProjectImgs = ViewBag.ProjectImgs;
    var ProjectPREs = ViewBag.ProjectPREs as List<int?>;
}
<style type="text/css">
    .myTag {
        font-size: 18px;
        font-weight: 500;
        margin-left: 20px;
        background-color: #de9d16;
        color: #fff;
        padding: 0px 10px 0px 10px
    }

    .myTag-lg {
        font-size: 20px;
        font-weight: 600;
        margin-left: 20px;
        background-color: #de9d16;
        color: #fff;
        padding: 0px 10px 0px 10px
    }
</style>
<div class="tpl-content-wrapper">
    <div class="row-content am-cf">
        <div class="row">
            <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
                <div class="widget am-cf">
                    <div data-am-sticky>
                    <div class="widget-head am-cf am-g" style="background-color:#fff">
                        <h1 style="font-size:20px">
                            项目详细信息
                        </h1>
                    </div>
                   </div>
                    <div class="widget-body  am-fr">
                        <div class="am-tabs" data-am-tabs >                         
                                <ul class="am-tabs-nav am-nav am-nav-tabs am-nav-justify my-am-tabs-nav" data-am-tabs="{noSwipe: 1}">
                                    <li class="am-active"><a href="#tab1">基本资料</a></li>
                                    <li><a href="#tab2">访谈纪要</a></li>
                                    <li><a href="#tab3">项目文档</a></li>
                                    <li><a href="#tab4">投资点评</a></li>
                                </ul>                               
                                <div class="am-tabs-bd">
                                    @*基本资料*@
                                    <div class="am-tab-panel am-fade am-in am-active" id="tab1" style="background-color:#dceddb;padding:20px">
                                        <form class="am-form am-form-horizontal">
                                            <ul class="am-list am-list-border am-list-striped">
                                                <li>
                                                    <a href="#" class="am-form-group" style="margin-bottom:0px;color:#808080">
                                                        <div class=" am-u-lg-6 am-u-md-6 am-u-sm-12">
                                                            <label class="" style="max-height:12px">项目名称:</label>
                                                            <span>text</span>
                                                        </div>
                                                        <div class="am-u-lg-6 am-u-md-6 am-u-sm-12">
                                                            <label class="" style="max-height:12px">项目编号:</label>
                                                            <i class="am-icon-home am-icon-fw"></i>
                                                            <span>text</span>
                                                        </div>
                                                    </a>
                                                </li>

                                                <li>
                                                    <a href="#" class="am-form-group" style="margin-bottom:0px;color:#808080">
                                                        <div class=" am-u-lg-12 am-u-md-12 am-u-sm-12">
                                                            <label class="" style="max-height:12px">行业标签:</label>
                                                            <span>text</span>
                                                        </div>

                                                    </a>
                                                </li>
                                                <li>
                                                    <a href="#" class="am-form-group" style="margin-bottom:0px;color:#808080">
                                                        <div class=" am-u-lg-12 am-u-md-12 am-u-sm-12">
                                                            <label class="" style="max-height:12px">地区:</label>
                                                            <i class="am-icon-map-marker am-icon-fw"></i>
                                                            <span>@ProjcetInfo.AreaName</span>
                                                        </div>

                                                    </a>
                                                </li>
                                                <li>
                                                    <a href="#" class="am-form-group" style="margin-bottom:0px;color:#808080">
                                                        <div class=" am-u-lg-12 am-u-md-12 am-u-sm-12">
                                                            <label class="" style="max-height:12px">项目主管:</label>
                                                            <i class="am-icon-male am-icon-fw"></i>
                                                            <span>@ProjcetInfo.UserName</span>
                                                        </div>

                                                    </a>
                                                </li>
                                                <li>
                                                    <a href="#" class="am-form-group" style="margin-bottom:0px;color:#808080">
                                                        <div class=" am-u-lg-6 am-u-md-6 am-u-sm-12">
                                                            <label class="" style="max-height:12px">公司名称:</label>
                                                            <span>@ProjcetInfo.CompName</span>
                                                        </div>
                                                        <div class=" am-u-lg-6 am-u-md-6 am-u-sm-12">
                                                            <label class="" style="max-height:12px">微信公号:</label>
                                                            <i class="am-icon-weixin am-icon-fw"></i>
                                                            <span>@ProjcetInfo.ProWeChat</span>
                                                        </div>
                                                    </a>
                                                </li>
                                                <li>
                                                    <a href="#" class="am-form-group" style="margin-bottom:0px;color:#808080">
                                                        <div class=" am-u-lg-6 am-u-md-6 am-u-sm-12">
                                                            <label class="" style="max-height:12px">项目网站:</label>
                                                            <span>@ProjcetInfo.ProWebUrl</span>
                                                        </div>
                                                        <div class=" am-u-lg-6 am-u-md-6 am-u-sm-12">
                                                            <label class="" style="max-height:12px">项目APP:</label>
                                                            <i class="am-icon-android am-icon-fw"></i>
                                                            <span>@ProjcetInfo.ProApp</span>
                                                        </div>
                                                    </a>
                                                </li>
                                                <li>
                                                    <a href="#" class="am-form-group" style="margin-bottom:0px;color:#808080">
                                                        <div class=" am-u-lg-4 am-u-md-4 am-u-sm-12">

                                                            <label class="" style="max-height:12px">创始人:</label>
                                                            <i class="am-icon-male am-icon-fw"></i>
                                                            <span>@ProjcetInfo.Originator</span>
                                                        </div>
                                                        <div class=" am-u-lg-4 am-u-md-4 am-u-sm-12">

                                                            <label class="" style="max-height:12px">邮箱:</label>
                                                            <i class="am-icon-at am-icon-fw"></i>
                                                            <span>@ProjcetInfo.OriginatorEmail</span>
                                                        </div>
                                                        <div class=" am-u-lg-4 am-u-md-4 am-u-sm-12">

                                                            <label class="" style="max-height:12px">手机号:</label>
                                                            <i class="am-icon-phone am-icon-fw"></i>
                                                            <span>@ProjcetInfo.OriginatorPhone</span>
                                                        </div>
                                                    </a>

                                                </li>
                                                <li>
                                                    <a href="#" class="am-form-group" style="margin-bottom:0px;color:#808080">
                                                        <div class=" am-u-lg-4 am-u-md-4 am-u-sm-12">
                                                            <label class="" style="max-height:12px">联系人:</label>
                                                            <i class="am-icon-male am-icon-fw"></i>
                                                            <span>@ProjcetInfo.Contact</span>
                                                        </div>
                                                        <div class=" am-u-lg-4 am-u-md-4 am-u-sm-12">

                                                            <label class="" style="max-height:12px">邮箱:</label>
                                                            <i class="am-icon-at am-icon-fw"></i>
                                                            <span>@ProjcetInfo.ContactEmail</span>
                                                        </div>
                                                        <div class=" am-u-lg-4 am-u-md-4 am-u-sm-12">
                                                            <label class="" style="max-height:12px">手机号:</label>
                                                            <i class="am-icon-phone am-icon-fw"></i>
                                                            <span>@ProjcetInfo.ContactPhone</span>
                                                        </div>
                                                    </a>
                                                </li>
                                                <li>
                                                    <a href="#" class="am-form-group" style="margin-bottom:0px;color:#808080">
                                                        <div class=" am-u-lg-1 am-u-md-2 am-u-sm-4">
                                                            <label class="" style="max-height:12px"> Pre-DD CheckList</label>

                                                        </div>
                                                        <div class=" am-u-lg-11 am-u-md-10 am-u-sm-8">
                                                            <ul class="am-avg-sm-4">
                                                                @{Html.RenderAction("GetCheckBoxs_PRE", "Constant", new { ProjectPREs });}
                                                            </ul>
                                                        </div>

                                                    </a>

                                                </li>
                                            </ul>

                                            <div class="am-panel am-panel-default">
                                                <div class="am-panel-hd">
                                                    <h4 class="am-panel-title" data-am-collapse="{ target: '#do-not-say-1'}">
                                                        项目简介
                                                    </h4>
                                                </div>
                                                <div id="do-not-say-1" class="am-panel-collapse am-collapse am-in">
                                                    <textarea class="" rows="5" id="txr_ProBrief">@ProjcetInfo.ProBrief</textarea>
                                                </div>
                                            </div>
                                            <div class="am-panel am-panel-default">
                                                <div class="am-panel-hd">
                                                    <h4 class="am-panel-title" data-am-collapse="{parent: '#accordion', target: '#do-not-say-2'}">
                                                        投资逻辑
                                                    </h4>
                                                </div>
                                                <div id="do-not-say-2" class="am-panel-collapse am-collapse am-in">
                                                    <textarea class="" rows="5" id="txr_InvestmentLogic">@ProjcetInfo.InvestmentLogic</textarea>
                                                </div>
                                            </div>
                                            <div class=" am-u-lg-12 am-u-md-12 am-u-sm-12">
                                                <div class="am-slider am-slider-default" data-am-flexslider id="demo-slider-0">
                                                    <ul class="am-slides">
                                                        @{
                                                            if (ProjectImgs != null)
                                                            {
                                                                foreach (var item in ProjectImgs)
                                                                {
                                                                    try
                                                                    {
                                                                        <li><img class="liImg" src="@item.FilePath" /></li>
                                                                    }
                                                                    catch (Exception)
                                                                    {

                                                                        continue;
                                                                    }
                                                                }
                                                            }

                                                        }

                                                    </ul>
                                                </div>
                                            </div>
                                        </form>

                                    </div>
                                    @*访谈纪要*@
                                    <div class="am-tab-panel am-fade" id="tab2" style="background-color:#dceddb;padding:20px">
                                        <form class="am-form am-form-horizontal" style="max-height:1900px">
                                            <div class="am-form-group ">
                                                <div class="am-panel-group am-u-lg-12 am-u-md-12 am-u-sm-12" id="">
                                                    @{
                                                        if (ProjectDocmentList != null)
                                                        {
                                                            foreach (var item in ProjectDocmentList)
                                                            {
                                                                <div class="am-panel am-panel-default">
                                                                    <div class="am-panel-hd">
                                                                        <h4 class="am-panel-title" data-am-collapse="{ target: '#ProDecment-1'}">
                                                                            @item.Subject
                                                                        </h4>
                                                                    </div>
                                                                    <div id="ProDecment-1" class="am-panel-collapse am-collapse am-in" style="padding:15px">
                                                                        <div class="am-form-group" style="margin-bottom:0px">
                                                                            <label>主题：</label> @item.Subject
                                                                        </div>
                                                                        <div class="am-form-group" style="margin-bottom:0px">
                                                                            <label>地点：</label> @item.Area
                                                                        </div>
                                                                        <div class="am-form-group" style="margin-bottom:0px">
                                                                            <label>内部人员：</label>@item.InnerMan
                                                                        </div>
                                                                        <div class="am-form-group" style="margin-bottom:0px">
                                                                            <label>外部人员：</label>@item.OuterMan
                                                                        </div>
                                                                        <div class="am-form-group" style="margin-bottom:0px">
                                                                            <label>会议时间：</label>@{Convert.ToDateTime(item.SortTime).ToString("yyyy年MM月dd日 HH:mm:ss");}
                                                                        </div>
                                                                        <div class="am-form-group" style="">
                                                                            <label>文档最后修改时间：</label>@{Convert.ToDateTime(item.UpdateTime).ToString("yyyy年MM月dd日 HH:mm:ss");}
                                                                        </div>
                                                                        <div class="am-form-group" style="margin-bottom:0px">
                                                                            <pre>@item.Content</pre>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            }
                                                        }
                                                    }
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    @*项目文档*@
                                    <div class="am-tab-panel am-fade" id="tab3" style="background-color:#dceddb;padding:20px">
                                        <table style="width:100%" class="am-table am-table-compact am-table-striped tpl-table-black am-table-hover am-text-nowrap" id="tb_projectDocment">
                                            <thead>
                                                <tr>
                                                    <th>序号</th>
                                                    <th data-bind="FileSName">文件名称</th>
                                                    <th data-bind="ProPhaseName">项目阶段</th>
                                                    <th data-bind="FileDesc">文件描述</th>
                                                    <th data-bind="FileType">文件类型</th>
                                                    <th data-bind="FileSize">大小</th>
                                                    <th data-bind="InsertTime">更新日期</th>
                                                    <th data-bind="UserName">操作人</th>
                                                    <th>下载</th>
                                                </tr>

                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>1</td>
                                                    <td>ceshi</td>
                                                    <td>ceshi</td>
                                                    <td>ceshi</td>
                                                    <td>ceshi</td>
                                                    <td>ceshi</td>
                                                    <td>ceshi</td>
                                                    <td>ceshi</td>
                                                    <td>
                                                        <div class="tpl-table-black-operation">
                                                            <a href="~/Upload/201806/txt/3d01d57b51644bd5acb79c884c0f95c2.txt">
                                                                <i class="am-icon-cloud-download"></i> 下载
                                                            </a>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    @*项目点评*@
                                    <div class="am-tab-panel am-fade" id="tab4" style="background-color:#f1f6ed;padding:20px">
                                        <form class="am-form ">
                                            <fieldset>
                                                <legend style="margin-bottom:0px">
                                                    <span class="myTag-lg">@ProjcetInfo.ProName</span>
                                                    <span class="" style="margin-left:20px">投资点评</span>
                                                    <button type="button" class="am-btn am-btn-primary am-radius am-fr " id="btn_AddComment">
                                                        <i class="am-icon-pencil"></i>&nbsp;&nbsp;写评论
                                                    </button>
                                                </legend>
                                                <div id="commentList" class="am-form-group  am-scrollable-vertical" style="max-height:500px;height:auto">
                                                    <ul class="am-comments-list am-comments-list-flip">
                                                        <li class="am-comment">
                                                            <a href="#link-to-user-home">
                                                                <img src="~/res/assets/img/user04.png" alt="" class="am-comment-avatar" width="48" height="48" />
                                                            </a>
                                                            <div class="am-comment-main">
                                                                <header class="am-comment-hd">
                                                                    <!--<h3 class="am-comment-title">评论标题</h3>-->
                                                                    <div class="am-comment-meta">
                                                                        <a href="#link-to-user" class="am-comment-author">某人</a>
                                                                        评论于 <time datetime="2013-07-27T04:54:29-07:00" title="2013年7月27日 下午7:54 格林尼治标准时间+0800">2014-7-12 15:30</time>
                                                                        <span class="myTag">
                                                                            A 轮
                                                                        </span>
                                                                    </div>

                                                                </header>

                                                                <div class="am-comment-bd">
                                                                    <pre style="margin:0px">
                                                                测试评论信息
                                                                </pre>
                                                                </div>
                                                            </div>
                                                        </li>

                                                    </ul>

                                                </div>
                                                <div id="pl_CommentList" class="am-u-lg-12 am-cf">
                                                    <div class="am-fr">
                                                        <ul class="am-pagination tpl-pagination">
                                                            <li class="am-disabled"><a href="#">«</a></li>
                                                            <li class="am-active"><a href="#">1</a></li>
                                                            <li><a href="#">2</a></li>
                                                            <li><a href="#">3</a></li>
                                                            <li><a href="#">4</a></li>
                                                            <li><a href="#">5</a></li>
                                                            <li><a href="#">»</a></li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var ProId = "@ProjcetInfo.Id";
    var ProPhase = "@ProjcetInfo.ProPhaseName";
    var pageOpt = {};
    var commentModel = GetNewCommentModel();

    $(function(){
        BindProjectDocmentTable(ProId);
        Laod_tb_CommentList({ PageIndex:1 });
        $("#btn_AddComment").click(function () {
            CommentModelOpen("", ProId, ProPhase);
        });
        var width = 0;
        if ($(".liImg")) {
            width = $(".liImg")[0].width;
            $(".liImg").css("height", width * 14 / 16);
        }
    });
     //绑定项目文档列表
    function BindProjectDocmentTable(proId) {
           var TBcolumns = GetTableTh("tb_projectDocment");
           $.ajaxPost({
            url: '@Url.Content("~/ProjectManege/SelProjectDocmentDownList")',
               data: {
                   "ProId": proId, "TBcolumns": TBcolumns, actionID: "Id", doEitFunction: "",
                   doDelFunction: "",PageSize:100
               },
               success: function (result) {
                   debugger;
                   $('#tb_projectDocment>tbody').html(result.data);
            }
        });
    };
    function GetCommentHtml(data) {
        debugger;
        var commentHtml = "";
        var rowComment = "";
        for (var i = 0; i < data.length; i++) {
            rowComment = "";
            rowComment += "<li class=\"am-comment\">";
            rowComment += "<a href=\"#link-to-user-home\">";
            rowComment +="<img src={0} alt=\"\" class=\"am-comment-avatar\" width=\"48\" height=\"48\" />"
            rowComment += '</a><div class="am-comment-main"><header class="am-comment-hd"><div class="am-comment-meta">';
            rowComment += '<a href="#link-to-user" class="am-comment-author">{1}</a>&nbsp;&nbsp;&nbsp;&nbsp;评论于 <time>{2}</time>';
            rowComment += '<span class="myTag">{3}</span></div> </header>';
            rowComment += '<div class="am-comment-bd"><pre style="margin:0px">{4}</pre></div></div></li>';
            var InsertTime = ConvertJSONDateToJSDate(data[i].InsertTime).Format("yyyy-MM-dd HH:mm:ss");
            commentHtml += rowComment.format(data[i].AccountIcon, data[i].AccountName, InsertTime , data[i].ProPhase, data[i].Content);
           
        }
        return commentHtml;
    };
    function Laod_tb_CommentList(options) {
        debugger;
        pageOpt = $.extend($.defaultsPage, options);
        pageOpt.PageSize = 5;
        pageOpt.ID = "pl_CommentList";
        pageOpt.ClickFun = "Laod_tb_CommentList";
        $.ajaxPost({
            url: '@Url.Content("~/Comment/GetProjectCommentListData")',
            data: { "proId": ProId, "PageIndex": pageOpt.PageIndex, "PageSize": pageOpt.PageSize},
            success: function (result) {
                if (result.data != null) {
                    var dataHtml = GetCommentHtml(result.data);
                    //alert(dataHtml);
                    $('#commentList>ul').html(dataHtml);
                }
                //$('#tb_Notice>tbody').html(result.data);
                pageOpt = $.extend(pageOpt, result.pageInfo);
                $.BindPageList(pageOpt);
            }
        });
    };
    var SaveCommentInfo = function () {
        commentModel.Subject=$('#inp_mo_CommentSubject').val();
        commentModel.Content= $("#tr_mo_CommentContent").val();
          $.ajaxPost({
                        url: '@Url.Content("~/Comment/SaveComment")',
                        data: { CommentModel: commentModel  },
                        success: function (result) {
                         Laod_tb_CommentList({ PageIndex: pageOpt.PageIndex });
                        }
          });
    };
       //打开公告附件模态框
    var CommentModelOpen = function (Id, ProId, ProPhase) {
        commentModel = GetNewCommentModel();
                if (typeof (Id) != "undefined" && Id != "") {
                    $.ajaxPost({
                        url: '@Url.Content("~/Comment/GetCommentData")',
                        data: { Id: Id },
                        success: function (result) {
                            commentModel = $.extend({}, commentModel, result);
                        }
                    });
              }
        commentModel.Id = Id;
        commentModel.ProId = ProId;
        commentModel.ProPhase = ProPhase;
        $('#inp_mo_CommentSubject').val(commentModel.Subject);
             $("#tr_mo_CommentContent").val(commentModel.Content);
                $('#modal_Comment').modal({
                    closeViaDimmer: false,
                    onConfirm: function (options) {
                        debugger;
                        SaveCommentInfo();
                    }
                });
        };
</script>


